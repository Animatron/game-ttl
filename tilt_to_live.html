<!DOCTYPE html>
<html>
	<head>
		<title>Tilt to Live - Animatron HTML5 Player Demo</title>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
		<script src="../player/vendor/matrix.js" type="text/javascript"></script>
		<script src="../player/player.js" type="text/javascript"></script>
		<script src="../player/builder.js" type="text/javascript"></script>
		<script src="../player/animatron_import.js" type="text/javascript"></script>

		<script type="text/javascript">	
            function start() {
                var b = Builder._$, B = Builder, C = anm.C;
				var width = 640;
				var height = 480;
				
				var numEnemies = 50;
				var spawn = [4, 16];
				
				var mouseX = 0;
				var mouseY = 0;
				var targetX = 0;
				var targetY = 0;
				
          		var dot = b().circle([ 0, 0 ], 4).fill('#f00');
				var swarm = new Array(numEnemies);
				var msg = b().paint(function(ctx) {
      							ctx.font = '30pt sans-serif';
      							ctx.fillText('Game Over', 210, 260);
    						});
				
				var lastTime = new Array(numEnemies);
				var spawnTime = new Array(numEnemies);
				
				var dotModifier = function(t, i) {
					// the check for t doesn't make sense
					if (t > 1) {
						if (t >= spawnTime[i]) {
							// initialize position
							this.x = Math.random()*width;
							this.y = Math.random()*height;
							//console.log(i, this.x, this.y);
							
							// randomize next spawn
							lastTime[i] = spawnTime[i];
							spawnTime[i] = t + Math.random()*(spawn[1] - spawn[0]) + spawn[0];
						}
						this.x += (targetX - this.x > 0 ? 1 : -1) * Math.max(.1, Math.min(Math.atan(t - lastTime[i]), Math.abs(targetX - this.x)/20));
						this.y += (targetY - this.y > 0 ? 1 : -1) * Math.max(.1, Math.min(Math.atan(t - lastTime[i]), Math.abs(targetY - this.y)/20));
						
						// collision check
						if ((this.x - targetX)*(this.x - targetX) + (this.y - targetY)*(this.y - targetY) <= 16) {
								scene1.v.children[scene1.v.children.length - 1].visible = true;
						}
					}
					return true;
				};
				
                // canvas1
                var scene1 = b();
				
				var area = b().rect([width/2, height/2], [width, height]).fill('#fff');
				dot.on(C.X_MMOVE, function(evt) {
					mouseX = evt.pos[0];
					mouseY = evt.pos[1];
					return true;
				}).modify(function(t) {
					this.x += (mouseX - this.x)/10;
					this.y += (mouseY - this.y)/10;
					targetX = this.x;
					targetY = this.y;
					return true;
				});
				scene1.add(area);
				for (var i=0; i<swarm.length; i++) {
					spawnTime[i] = 0;
					swarm[i] = b().circle([ 0, 0 ], 2).fill('#000')
							.modify(dotModifier, i);
					scene1.add(swarm[i]);
				}
				scene1.add(dot);
				scene1.add(msg);
				scene1.v.children[scene1.v.children.length - 1].visible = false;
				
                createPlayer('canvas1', {'mode': C.M_DYNAMIC}).load(scene1).play();
    
            }
        </script>
      </head>

	<body onload="start();">
		<h1>Tilt to Live - Animatron HTML5 Player Demo</h1>

		<!-- canvas1 -->
		<canvas id="canvas1" width="640" height="480"></canvas>

	</body>

</html>